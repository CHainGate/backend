openapi: 3.0.0
servers:
  - url: 'http://localhost:8000/api/config'
info:
  description: >-
    This is the config OpenAPI definition.
  version: 1.0.0
  title: Config OpenAPI
tags:
  - name: config
  - name: authentication
  - name: wallet
  - name: api-key
  - name: logging
paths:
  /config:
    get:
      tags:
        - config
      summary: Get the configuration
      security:
        - bearerAuth: []
      parameters:
        - in: header
          name: authorization
          schema:
            type: string
      operationId: getConfig
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConfigResponseDto'

  /login:
    post:
      tags:
        - authentication
      summary: Authenticate to chaingate
      operationId: login
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponseDto'
        '403':
          description: wrong username or password
      requestBody:
        $ref: '#/components/requestBodies/LoginRequestDto'

  /register:
    post:
      tags:
        - authentication
      summary: Merchant registration
      operationId: registerMerchant
      responses:
        '201':
          description: new merchant registred
      requestBody:
        $ref: '#/components/requestBodies/RegisterRequestDto'

  /verifyemail:
    get:
      tags:
        - authentication
      summary: Verify merchant email
      operationId: verifyEmail
      parameters:
        - in: query
          name: email
          required: true
          schema:
            type: string
        - in: query
          name: verification_code
          schema:
            type: integer
            format: int64
          required: true
          description: Email verification code
      responses:
        '200':
          description: successful operation
        '400':
          description: email or verification code invalid

  /wallet:
    get:
      tags:
        - wallet
      summary: get wallets
      operationId: getWallets
      security:
        - bearerAuth: []
      parameters:
       - in: query
         name: mode
         required: true
         schema:
           type: string
           enum:
            - test
            - main
       - in: header
         name: authorization
         schema:
           type: string
      responses:
        '200':
          description: operation successful
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/WalletResponseDto'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
    post:
      tags:
        - wallet
      summary: add new wallet address
      operationId: addWallet
      security:
        - bearerAuth: []
      parameters:
        - in: header
          name: authorization
          schema:
            type: string
      responses:
        '201':
          description: new wallet created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WalletResponseDto'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
      requestBody:
        $ref: '#/components/requestBodies/WalletRequestDto'

  /wallet/{wallet_id}:
    delete:
      tags: 
        - wallet
      summary: delete wallet
      operationId: deleteWallet
      parameters:
        - in: path
          name: wallet_id
          required: true
          schema:
            type: string
            format: uuid
        - in: header
          name: authorization
          schema:
            type: string
      security:
        - bearerAuth: []
      responses: 
        '200':
          description: wallet deleted
        '400':
          description: wallet does not exist
        '401':
          $ref: '#/components/responses/UnauthorizedError'
          
          
  /apikey:
    get:
      tags:
        - api-key
      summary: gets the api key
      operationId: getApiKey
      parameters:
        - in: query
          name: mode
          required: true
          schema: 
            type: string
            enum:
              - test
              - main
        - in: query
          name: key_type
          required: true
          schema:
            type: string
            enum:
              - secret
              - public
        - in: header
          name: authorization
          schema:
            type: string
      security:
        - bearerAuth: []
      responses:
        '200':
          description: return
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiKeyResponseDto'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
    post:
      tags:
        - api-key
      summary: create new secret api key
      operationId: generateApiKey
      parameters:
        - in: header
          name: authorization
          schema:
            type: string
      security:
        - bearerAuth: [ ]
      responses:
        '201':
          description: API key generated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiKeyResponseDto'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
      requestBody:
        $ref: '#/components/requestBodies/ApiKeyRequestDto'

  /apiKey/{api_key_id}:
    delete:
      tags:
        - api-key
      summary: delete api key
      operationId: deleteApiKey
      parameters:
        - in: path
          name: api_key_id
          required: true
          schema:
            type: string
            format: uuid
        - in: header
          name: authorization
          schema:
            type: string
      security:
        - bearerAuth: []
      responses:
        '200':
          description: api key deleted
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /logging:
    get:
      tags:
        - logging
      summary: get logging information
      operationId: getLoggingInformation
      parameters:
        - in: query
          name: mode
          required: true
          schema: 
            type: string
            enum:
              - test
              - main
        - in: header
          name: authorization
          schema:
            type: string
      security:
        - bearerAuth: []
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/LoggingResponseDto'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  responses:
    UnauthorizedError:
      description: Access token is missing or invalid
  requestBodies:
    LoginRequestDto:
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/LoginRequestDto'
    RegisterRequestDto:
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/RegisterRequestDto'
    WalletRequestDto:
      content:
        application/json:
          schema: 
            $ref: '#/components/schemas/WalletRequestDto'
    ApiKeyRequestDto:
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiKeyRequestDTO'
  schemas:
    ConfigResponseDto:
      title: Config Response DTO
      type: object
      properties:
        supportedCryptoCurrencies:
          type: array
          items:
            $ref: '#/components/schemas/currency'
    LoginRequestDto:
      title: Login Request DTO
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          example: my@email.ch
        password:
          type: string
          example: my-secret-password
    TokenResponseDto:
      title: Token Response DTO
      type: object
      required:
        - token
      properties:
        token:
          type: string
          example: example-jwt-token
    RegisterRequestDto:
      title: Register Request DTO
      type: object
      required: 
        - first_name
        - last_name
        - email
        - password
      properties:
        first_name:
          type: string
        last_name:
          type: string
        email:
          type: string
        password:
          type: string
    WalletResponseDto:
      title: Wallet Response DTO
      type: object
      required:
        - id
        - currency
        - address
        - mode
      properties:
        id:
          type: string
          format: uuid
        currency:
          type: string
          enum:
            - eth
            - btc
        address:
          type: string
        mode:
          type: string
          enum:
            - test
            - main
    WalletRequestDto:
      title: Wallet Request DTO
      type: object
      required:
        - currency
        - address
        - mode
      properties:
        currency:
          type: string
          enum:
            - eth
            - btc
        address:
          type: string
        mode:
          type: string
          enum:
            - test
            - main
    ApiKeyResponseDto:
      title: Api Key Response DTO
      type: object
      required:
        - id
        - key
        - key_type
        - created_at
      properties:
        id:
          type: string
          format: uuid
        key:
          type: string
        key_type:
          type: string
          enum:
            - secret
            - public
        created_at:
          type: string
          format: date-time
    ApiKeyRequestDTO:
      title: Api Key Request Dto
      type: object
      required:
        - mode
        - key_type
      properties:
        mode:
          type: string
          enum:
            - test
            - main
        key_type:
          type: string
          enum:
            - secret
            - public
    LoggingResponseDto:
      title: Logging Informations Response DTO
      type: object
      required:
        - payment_id
        - callback_url
        - created_at
        - updated_at
        - history
      properties:
        payment_id:
          type: string
          format: uuid
        callback_url:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        history:
          type: array
          items:
            $ref: '#/components/schemas/PaymentHistory'
    PaymentHistory:
      title: Payment History
      type: object
      required:
        - id
        - pay_address
        - price_amount
        - price_currency
        - pay_amount
        - pay_currency
        - pay_address
        - actually_paid
        - payment_state
        - created_at
      properties:
        id:
          type: string
          format: uuid
        pay_address:
          type: string
        price_amount:
          type: number
          format: double
        price_currency:
          type: string
          enum:
            - usd
            - chf
        pay_amount:
          type: string
        pay_currency:
          type: string
          enum:
            - eth
            - btc
        actually_paid:
          type: string
        payment_state:
          type: string
          enum:
            - waiting
            - partially_paid 
            - paid
            - sending
            - finished
            - expired
            - failed
        created_at:
          type: string
          format: date-time
    currency:
      title: Currency
      type: object
      properties:
        name:
          type: string
        shortName:
          type: string