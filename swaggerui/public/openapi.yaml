openapi: 3.0.0
servers:
  - url: 'http://localhost:8000/api/public'
info:
  description: >-
    This is the public OpenAPI definition.
  version: 1.0.0
  title: Public OpenAPI
tags:
  - name: payment
paths:
  /payment:
    post:
      tags:
        - payment
      summary: Create a new payment
      description: 'Create a new payment'
      operationId: newPayment
      security:
        - ApiKeyAuth: []
      parameters:
        - in: header
          name: X-API-KEY
          schema:
            type: string
      responses:
        '201':
          description: payment created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentResponseDto'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
      requestBody:
        $ref: '#/components/requestBodies/Payment'
components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-KEY
  responses:
    UnauthorizedError:
      description: Access token is missing or invalid
  requestBodies:
    Payment:
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/PaymentRequestDto'
  schemas:
    PaymentResponseDto:
      title: Payment Response DTO
      type: object
      required:
        - id
        - pay_address
        - price_currency
        - pay_amount
        - pay_currency
        - actually_paid
        - callback_url
        - payment_state
        - created_at
        - updated_at
      properties:
          id:
           type: string
           format: uuid
          pay_address:
           type: string
          price_amount:
           type: number
           format: double
          price_currency:
           type: string
           enum:
             - usd
             - chf
          pay_amount:
           type: number
           format: double
          pay_currency:
           type: string
           enum:
             - eth
             - btc
          actually_paid:
           type: number
           format: double
           nullable: true
          callback_url:
           type: string
          payment_state:
           type: string
           enum:
             - waiting
             - partially_paid 
             - paid
             - sending
             - finished
             - expired
             - failed
          created_at:
           type: string
           format: date-time
          updated_at:
           type: string
           format: date-time
    PaymentRequestDto:
      title: Payment Request DTO
      type: object
      required:
        - price_currency
        - price_amount
        - pay_currency
        - callback_url
      properties:
        price_currency:
          type: string
          enum:
            - usd
            - chf
        price_amount:
          type: number
          format: double
        pay_currency:
          type: string
          enum:
            - eth
            - btc
        callback_url:
          type: string